## Ecosystem Monitoring Survey

```{r, echo = FALSE}
# generate token
token = arcgisutils::auth_client()

# feature server url
ecomon_url =  'https://services2.arcgis.com/C8EMgrsFcRFL6LrL/arcgis/rest/services/Ecosystem_Monitoring_Strata/FeatureServer/'

# metadata
ecomon_meta = arcgisutils::fetch_layer_metadata(url = ecomon_url, token = token)
```

```{r, echo = FALSE}
# InPort
inport_href = ecomon_meta$serviceDescription |>
  rvest::read_html() |>
  rvest::html_node('a') |>
  rvest::html_attr('href')

# description
ecomon_desc = gsub('(.*?)</a>\\.\\s+', '', ecomon_meta$serviceDescription)
```

### InPort Metadata

Yes, see [here](`r inport_href`).

### Description

`r ecomon_desc`

### Extent

```{r, echo = FALSE}
# get layer bounding box
ecomon_bb = data.frame(
  x = c(ecomon_meta$fullExtent$xmin, ecomon_meta$fullExtent$xmax), 
  y = c(ecomon_meta$fullExtent$ymin, ecomon_meta$fullExtent$ymax)) |>
  sf::st_as_sf(coords = c('x', 'y'), crs = ecomon_meta$fullExtent$spatialReference$latestWkid) |>
  sf::st_bbox() |>
  sf::st_as_sfc() |>
  sf::st_transform(4326)
  
# leaflet map
leaflet::leaflet() |>
  leaflet::addTiles() |>
  leaflet::addPolygons(data = ecomon_bb)
```
